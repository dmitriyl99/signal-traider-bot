<!--
    Simple static Telegram WebApp. Does not verify the WebAppInitData, as a bot token would be needed for that.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>python-telegram-bot Example WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://widget.cloudpayments.uz/bundles/cloudpayments.js"></script>
</head>
<script type="text/javascript">
    Telegram.WebApp.ready();
    const params = new Proxy(new URLSearchParams(window.location.search), {
        get: (searchParams, prop) => searchParams.get(prop),
    });
    const localization = {
        'ru-RU': 'Оплатить',
        'uz-UZ': "To'lash"
    }
    const langauge = params.language;
    const payment_id = params.payment_id;
    const amount = params.amount;
    const subscriptionName = params.subscription_name;
    const accountId = params.user_id;
    this.pay = function () {
        var widget = new cp.CloudPayments({
            langauge: 'ru-RU'
        });
        widget.pay('charge', // или 'auth'
            { //options
                publicId: 'pk_37b7e1e4e2163ea482d130606076a', //id из личного кабинета
                description: 'Оплата подписки Masspay ' + subscriptionName, //назначение
                amount: amount, //сумма
                currency: 'UZS', //валюта
                accountId: accountId, //идентификатор плательщика (необязательно)
                invoiceId: payment_id, //номер заказа  (необязательно)
                skin: "mini", //дизайн виджета (необязательно)
            },
            {
                onSuccess: function (options) { // success
                    console.log('success', options)
                },
                onFail: function (reason, options) { // fail
                    console.log('error', reason, options)
                },
                onComplete: function (paymentResult, options) { //Вызывается как только виджет получает от api.cloudpayments ответ с результатом транзакции.
                    console.log('complete', paymentResult, options);
                }
            }
        )
    };
    Telegram.WebApp.MainButton.setText(localization[langauge]).show()
</script>
<body style="background-color: #ffffff; padding: 50px">
</body>
<script type="text/javascript">
    Telegram.WebApp.expand();
</script>
</html>